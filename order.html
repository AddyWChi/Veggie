<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>訂單計算機</title>
</head>
<body>
  <div id="error"> </div>
  <div id="menuList" class="container-fluid my-3"> </div>
  <div id="orderList" class="container-fluid my-3"> </div>

  <div class="container-fluid">
    <div class="my-3 d-flex justify-content-center">
      <label>訂單： </label> <input type="text" id="totalAmt" disabled>
    </div>
    <div class="my-3 d-flex justify-content-center">
      <button class="btn btn-success rounded-pill px-3" id="btnFunction" onclick="clearOrder()">開始新單</button>
    </div>
  </div>
  <script>
    let _orderList = document.getElementById("orderList");
    let _menuList = document.getElementById("menuList");
    let _order = {};
    let _menu = {
      "脆薯條 小": 35, "脆薯條 大": 55,
      "微笑薯餅 5個": 35,
      "三角薯餅 4個": 35,
      "帶皮薯條": 50,
      "杏鮑菇 小": 35, "杏鮑菇 大": 55,
      "秀珍菇 小": 35, "秀珍菇 大": 55,
      "香菇 小": 35, "香菇 大": 55,
      "珊瑚菇 小": 35, "珊瑚菇 大": 55,
      "金針菇 小": 35, "金針菇 大": 55,
      "雪白菇": 55,
      "鹽酥G 小": 35, "鹽酥G 大": 55,
      "地瓜條 小": 35, "地瓜條 大": 55,
    };

    document.addEventListener("DOMContentLoaded", () => {
      console.log("Document loaded!");
      document.getElementById('totalAmt').value = 0;

      // Add menu item button by looping through the menu list
      // Each row has 3 cells
      let cellCount = 1;
      let rowDiv = document.createElement("div");
      rowDiv.classList.add("row");
      _menuList.appendChild(rowDiv);
      for (const item in _menu) {
        console.log("item: " + item + " " + _menu[item]);
        if (cellCount >= 4) {
          rowDiv = document.createElement("div");
          rowDiv.classList.add("row");
          _menuList.appendChild(rowDiv);
          cellCount = 1;
        }

        const btnMenuItem = document.createElement("button");
        btnMenuItem.type = "button";
        btnMenuItem.textContent = item + "(" + _menu[item] + ")";
        // outline-secondary
        btnMenuItem.classList.add("btn");
        btnMenuItem.classList.add("btn-outline-secondary");
        btnMenuItem.classList.add("col-md-4");
        btnMenuItem.classList.add("col-sm-12");
        btnMenuItem.onclick = () => addOrder(item);
        rowDiv.appendChild(btnMenuItem);
        cellCount++;
      }
    });

    function removeOrderTable() {
      while (_orderList.firstChild) {
        _orderList.removeChild(_orderList.firstChild);
      }
    }

    function clearOrder() {
      _order = {};
      document.getElementById('totalAmt').value = 0;
      document.getElementById('error').value = '';
      removeOrderTable();
    }

    function showOrders() {
      try {
        for (const key in _order) {
          const orderItem = document.createElement("div");
          orderItem.classList.add("row");
          orderItem.innerHTML = "<label class=\"col-4 d-flex justify-content-end\" >" + key + "  (x" + _order[key] + ") : $ " + _order[key] * _menu[key] + "</label>"
            + " <button type=\"button\" class=\"col-4 my-1 py-2 px-3 btn btn-outline-primary\" onclick=\"addOrder('" + key + "')\" > + 1 </button>"
            + " <button type=\"button\" class=\"col-4 my-1 py-2 px-3 btn btn-outline-info\" onclick=\"removeOrder('" + key + "')\" > - 1 </button>";
          _orderList.appendChild(orderItem);
        }
      } catch {
        document.getElementById('error').value = 'Error';
      }
    }

    function sumOrders() {
      let total = 0;
      for (const key in _order) {
        // console.log('order: ' + _order[key] + ' menu: ' + _menu[key]);
        total += _menu[key] * _order[key];
      }
      document.getElementById('totalAmt').value = total;
    }

    function addOrder(key) {
      console.log(Date.now() + ' function: addOrder - ' + key);
      try {
        if (_order.hasOwnProperty(key)) {
          // console.log(Date.now() + ' function: addOrder - already has key: ' + key);
          _order[key] = _order[key] + 1;
        } else {
          // console.log(Date.now() + ' function: addOrder - does not have key: ' + key);
          _order[key] = 1;
        }
        // console.log(Date.now() + ' function: addOrder - key has value: ' + _order[key]);
        // console.log(Date.now() + ' Current keys in the order: ' + Object.keys(_order));
        sumOrders();
      } catch {
        document.getElementById('error').value = '有錯誤';
      }

      removeOrderTable();
      showOrders();
    }

    function removeOrder(key) {
      console.log(Date.now() + ' function: removeOrder - ' + key);
      try {
        if (_order.hasOwnProperty(key)) {
          if (_order[key] > 1) {
            _order[key] = _order[key] - 1;
          } else {
            delete _order[key];
          }
        }
        sumOrders();
      } catch {
        document.getElementById('error').value = '有錯誤';
      }

      removeOrderTable();
      showOrders();
    }
  </script>
</body>
</html>